name: Update Photos

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
    - name: üöÄ Checkout with PAT
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.PAT_TOKEN }}
        
    - name: üìù Create test data
      run: |
        mkdir -p data
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π JSON —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
        echo '{
          "updated": "'$(date -Is)'",
          "message": "–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. –î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫–∞.",
          "photos": []
        }' > data/photos.json
        
    - name: ‚úÖ Commit changes
      run: |
        git config user.name "GitHub Actions Bot"
        git config user.email "actions-bot@users.noreply.github.com"
        
        # –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        git add data/photos.json
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏–π
        if ! git diff-index --quiet HEAD --; then
          git commit -m "ü§ñ Auto-update: $(date +'%Y-%m-%d %H:%M')"
          git push
        else
          echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        fi
