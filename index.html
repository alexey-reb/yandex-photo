<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .folders { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 30px; }
        .folder-btn { padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
        .folder-btn:hover { background: #45a049; }
        .folder-btn.active { background: #2196F3; }
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .photo-card { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.3s; }
        .photo-card:hover { transform: translateY(-5px); }
        .photo-card img { width: 100%; height: 200px; object-fit: cover; display: block; }
        .photo-info { padding: 15px; }
        .photo-name { font-weight: bold; margin-bottom: 5px; }
        .loading { text-align: center; padding: 50px; font-size: 18px; }
        .error { color: #f44336; padding: 20px; background: #ffebee; border-radius: 5px; margin: 20px 0; }
        footer { text-align: center; margin-top: 40px; padding: 20px; color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∑ –§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞</h1>
            <p id="last-updated">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </header>

        <div class="folders" id="folders-container">
            <!-- –ü–∞–ø–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
        </div>

        <div id="loading" class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π...</div>
        <div id="error" class="error" style="display: none;"></div>

        <div class="gallery" id="gallery-container">
            <!-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
        </div>

        <footer>
            <p>–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ GitHub Actions</p>
            <p id="photo-count"></p>
        </footer>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const DATA_URL = 'data/photos.json';  // –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É
        const CACHE_TIME = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç –∫–µ—à–∞

        class PhotoGallery {
            constructor() {
                this.currentFolder = 'all';
                this.allPhotos = {};
                this.init();
            }

            async init() {
                await this.loadData();
                this.renderFolders();
                this.renderPhotos();
            }

            async loadData() {
                try {
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage (–∫–µ—à)
                    const cached = localStorage.getItem('yandex_photos_data');
                    const cachedTime = localStorage.getItem('yandex_photos_time');
                    
                    if (cached && cachedTime && (Date.now() - cachedTime < CACHE_TIME)) {
                        this.allPhotos = JSON.parse(cached);
                        this.showMessage('–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                    } else {
                        const response = await fetch(DATA_URL + '?t=' + Date.now());
                        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                        
                        this.allPhotos = await response.json();
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à
                        localStorage.setItem('yandex_photos_data', JSON.stringify(this.allPhotos));
                        localStorage.setItem('yandex_photos_time', Date.now());
                    }
                    
                    this.hideLoading();
                    this.updateLastUpdated();
                } catch (error) {
                    this.showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏: ' + error.message);
                    this.hideLoading();
                }
            }

            renderFolders() {
                const container = document.getElementById('folders-container');
                const folders = Object.keys(this.allPhotos.folders || {});
                
                if (folders.length === 0) {
                    container.innerHTML = '<p>–ü–∞–ø–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                    return;
                }

                let html = `
                    <button class="folder-btn active" data-folder="all">
                        –í—Å–µ —Ñ–æ—Ç–æ (${this.getTotalPhotos()})
                    </button>
                `;
                
                folders.forEach(folder => {
                    const count = this.allPhotos.folders[folder].length;
                    html += `
                        <button class="folder-btn" data-folder="${folder}">
                            ${folder} (${count})
                        </button>
                    `;
                });
                
                container.innerHTML = html;
                
                // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                container.querySelectorAll('.folder-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const folder = e.target.dataset.folder;
                        this.setActiveFolder(folder);
                    });
                });
            }

            renderPhotos() {
                const container = document.getElementById('gallery-container');
                let photos = [];
                
                if (this.currentFolder === 'all') {
                    // –í—Å–µ —Ñ–æ—Ç–æ –∏–∑ –≤—Å–µ—Ö –ø–∞–ø–æ–∫
                    Object.values(this.allPhotos.folders || {}).forEach(folderPhotos => {
                        photos.push(...folderPhotos);
                    });
                } else {
                    photos = this.allPhotos.folders[this.currentFolder] || [];
                }
                
                if (photos.length === 0) {
                    container.innerHTML = '<p>–í —ç—Ç–æ–π –ø–∞–ø–∫–µ –Ω–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</p>';
                    return;
                }
                
                let html = '';
                photos.forEach(photo => {
                    const previewUrl = photo.preview_url || 'https://via.placeholder.com/250x200?text=No+Image';
                    const name = photo.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    
                    html += `
                        <div class="photo-card">
                            <img src="${previewUrl}" alt="${name}" loading="lazy">
                            <div class="photo-info">
                                <div class="photo-name">${name}</div>
                                <div class="photo-size">${this.formatSize(photo.size)}</div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                this.updatePhotoCount(photos.length);
            }

            setActiveFolder(folder) {
                this.currentFolder = folder;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                document.querySelectorAll('.folder-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.folder === folder) {
                        btn.classList.add('active');
                    }
                });
                
                this.renderPhotos();
            }

            getTotalPhotos() {
                let total = 0;
                Object.values(this.allPhotos.folders || {}).forEach(photos => {
                    total += photos.length;
                });
                return total;
            }

            formatSize(bytes) {
                if (!bytes) return '';
                const units = ['B', 'KB', 'MB', 'GB'];
                let size = bytes;
                let unitIndex = 0;
                
                while (size >= 1024 && unitIndex < units.length - 1) {
                    size /= 1024;
                    unitIndex++;
                }
                
                return `${size.toFixed(1)} ${units[unitIndex]}`;
            }

            updateLastUpdated() {
                const element = document.getElementById('last-updated');
                if (this.allPhotos.last_updated) {
                    const date = new Date(this.allPhotos.last_updated);
                    element.textContent = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${date.toLocaleString('ru-RU')}`;
                }
            }

            updatePhotoCount(count) {
                const element = document.getElementById('photo-count');
                element.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: ${count}`;
            }

            showMessage(text) {
                console.log(text);
            }

            showError(text) {
                const element = document.getElementById('error');
                element.textContent = text;
                element.style.display = 'block';
            }

            hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            new PhotoGallery();
        });
    </script>
</body>
</html>
