name: Download and Display Photos

on: workflow_dispatch

jobs:
  sync-photos:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0  # –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è rebase
    
    - uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: pip install requests
    
    - name: Download photos from Yandex.Disk
      env:
        YANDEX_DISK_TOKEN: ${{ secrets.YANDEX_DISK_TOKEN }}
      run: |
        echo "–°–∫–∞—á–∏–≤–∞—é —Ñ–æ—Ç–æ..."
        python scripts/download_photos.py
    
    - name: Configure Git
      run: |
        git config --local user.name "github-actions[bot]"
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
    
    - name: Commit and push changes
      run: |
        # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        git add --all
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if git diff --quiet --cached; then
          echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          exit 0
        fi
        
        # –ö–æ–º–º–∏—Ç–∏–º
        git commit -m "üì∏ Update photos $(date +'%Y-%m-%d %H:%M:%S UTC')"
        
        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º
        git pull --rebase origin main
        
        # –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        git push origin main
